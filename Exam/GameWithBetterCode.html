<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="Game.css">
        <title>Pacman v0.2</title>
    </head>
    <body>
        <canvas id="myCanvas" width="1200" height="800" style="border: 2px solid black"></canvas>
        <img id="fanstasmaRojo" src="./img/fantasma_rojo.png" width="45px">
        <script>
            const canvas = document.getElementById("myCanvas");
            const ctx = canvas.getContext("2d");    
            const img = document.getElementById("fanstasmaRojo"); 
		    let enemyspeed = 2;
            // Fondo de Pantalla
            function fondoNegro(){
                ctx.beginPath();
                ctx.fillStyle = "black";
                ctx.rect(0,0,1200,800);
                ctx.fill();
            }

            //Agregar detector de teclas 
            let tiempo = 0;
            let moveX = 0, moveY = 0, velocidad = 4; 
            let collisionIndex, lastMovement;
            let moverse = 890;
            document.addEventListener("keydown", (e) =>{
                switch (e.keyCode) {
                    case 87:
                        direction = 90; // Up
                        moveX = 0;
                        moveY = -velocidad;
                        lastMovement = 87;
                        break;
                    case 65:
                        moveY = 0;
                        moveX = -velocidad;
                        direction = 180; // Left7
                        lastMovement = 65;
                        break;
                    case 83:
                        moveX = 0;
                        moveY = velocidad;
                        direction = 270; // Down
                        lastMovement = 83;
                        break;
                    case 68:
                        moveY = 0;
                        moveX = velocidad;
                        direction = 0; // Right
                        lastMovement = 68;
                        break;
                    case 32:
                        destruirMuro(collisionIndex);
                        if(lastMovement == 68)
                            moveX = velocidad;
                        else if(lastMovement == 87)
                            moveY = -velocidad;
                        else if(lastMovement == 65)
                            moveX = -velocidad;
                        else
                            moveY = velocidad;
                        break;
                }
            })

            //Clases
            class DetectionParam{
                constructor(_x,_y,_width,_height){
                    this.x = _x;
                    this.y = _y;
                    this.width = _width;
                    this.height = _height;
                }
                set setX(_x){
                    this.x = _x;
                }
                get getX(){
                    return this.x;
                }
                set setY(_y){
                    this.y = _y;
                }
                get getY(){
                    return this.y;
                }
                set setWidth(_width){
                    this.width = _width;
                }
                get getWidth(){
                    return this.width;
                }
                set setHeight(_height){
                    this.height = _height;
                }
                get getHeight(){
                    return this.height;
                }
            }
            class Player extends DetectionParam{
                constructor(_x,_y,_width,_height, _rad){
                    super(_x,_y,_width,_height);
                    this.rad = _rad;
                }
                get getRad(){
                    return this.rad;
                }
                set setRad(_rad){
                    this.rad = _rad;
                }
            }
            class Enemy extends DetectionParam{
                constructor(_x,_y,_width, _img, _movementx, _movementy){
                    super(_x,_y,_width,_width);
                    this.img = _img;
                    this.movementx = _movementx;
                    this.movementy = _movementy;
                }

                set setImg(_img){
                    this.img = _img;
                }
                
                get getImg(){
                    return this.img;
                }

                set setMovementx(_movementx){
				    this.movementx = _movementx;
                }

                get getMovementx() {
                    return this.movementx;
                }

                set setMovementy(_movementy){
                    this.movementy = _movementy;
                }

                get getMovementy() {
                    return this.movementy;
                }
            }
            let enemies = [new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),
            new Enemy(580,380,40,img,Math.round(Math.random()),0),];
            class Wall extends DetectionParam{
                constructor(_x,_y,_width,_height){
                    super(_x,_y,_width,_height);
                }
            }

            //Creacion de objetos del mapa
            let player = new Player(400,200,20,20,20);

            //Graficos
            //Variables del dibujado jugador/pacman
            let radio = 20, x = 0, y = 0;
            let iterator = 0;
            let mouthAngle = 0; // Initial mouth angle
            let bocaFlag = false;             
            let direction = null;

            //AnimaciÃ³n y movimiento del pacman
            function animacionPacman() {
                //Caja de pacman
                // ctx.fillStyle = "red";
                // ctx.beginPath();
                // ctx.rect(player.getX, player.getY,player.getWidth*2,player.getHeight*2);
                // ctx.fill();

                //Circulo de pacman
                ctx.beginPath();
                x = player.getX + player.getRad;
                y = player.getY + player.getRad;
                ctx.moveTo(x, y);

                //Angulo de la boca
                const mouthRadians = (mouthAngle * Math.PI) / 260;

                let startAngle, endAngle;

                if (direction === 90) { // Arriba
                    startAngle = (Math.PI * 1.5) + (mouthRadians / 2);
                    endAngle = (Math.PI * 1.5) - (mouthRadians / 2);
                } else if (direction === 270) { // Abajo
                    startAngle = (Math.PI * 0.5) + (mouthRadians / 2);
                    endAngle = (Math.PI * 0.5) - (mouthRadians / 2);
                } else { // Izquierda - Derecha
                    startAngle = (mouthRadians / 2) + (direction * Math.PI) / 180;
                    endAngle = (2 * Math.PI) - ((mouthRadians / 2) + (direction * Math.PI) / 180);
                }

                //Boca
                ctx.arc(x, y, player.getRad, startAngle, endAngle); 
                ctx.lineTo(x, y); 
                ctx.fillStyle = "yellow"; 
                ctx.fill();

                //Abrir o cerrar la boca
                if (!bocaFlag) {
                    mouthAngle += 10;
                    if (mouthAngle >= 90) {
                        bocaFlag = true;
                    }
                } else {
                    mouthAngle -= 10;
                    if (mouthAngle <= 0) {
                        bocaFlag = false;
                    }
                }
                
                //Mover al jugador
                player.x += moveX;
                player.y += moveY;
            }

            //Variables para dibujar secciones de pared
            let altura = 14, anchura = 58, alturav = 58, anchurav = 13, grosorLinea = 8, walls = [];
            let gap = 1;
            let createFlag = false;
            let _indexx = 0;
            function cuerpoRectangulo(_x,_y,_orientacion,_agujero){
                ctx.beginPath();
                ctx.fillStyle = "black";
                if(_orientacion == 1){
                    if(!createFlag)
                        walls[_indexx] = (new Wall(_x,_y,anchura,altura));
                    
                    if(walls[_indexx].getX == 9999){
                        _indexx++;
                        return;
                    }else 
                        ctx.rect(walls[_indexx].getX+7,walls[_indexx].getY,anchura-15,altura);
                }
                else{
                    if(!createFlag)
                        walls[_indexx] = (new Wall(_x, _y,anchurav, alturav));

                    if(walls[_indexx].getX == 9999){
                        _indexx++;
                        return;
                    }else 
                        ctx.rect(walls[_indexx].getX,walls[_indexx].getY+7,anchurav,alturav-15);
                       
                }
                ctx.fill();

                ctx.beginPath();
                ctx.lineWidth = grosorLinea;
                if(_orientacion == 1){
                    ctx.moveTo(_x+gap,_y);
                    ctx.lineTo(_x+anchura-gap,_y);
                }else{
                    ctx.moveTo(_x+anchurav,_y+gap);
                    ctx.lineTo(_x+anchurav,_y+alturav-gap);
                }
                ctx.stroke();

                ctx.beginPath();
                ctx.strokeStyle = "blue";
                if(_orientacion == 1){
                    ctx.moveTo(_x+gap,_y+altura);
                    ctx.lineTo(_x+anchura-gap,_y+altura);
                }else{
                    ctx.moveTo(_x,_y+gap);
                    ctx.lineTo(_x,_y+alturav-gap);
                }
                ctx.stroke();
                _indexx += 1;
            }   

            //Cambiar a crear muros
            function dibujarEscenario(){
                _indexx = 0;
                //Apertura en la pared de arriba
                for(let i = 0; i<(1220-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + (i*anchura)-22,10,1,true);
                }
                //Apertura en la parte de abajo
                for(let i = 0; i<(1220-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + (i*anchura)-22,775,1,true);
                }
                //Pared vertical izquierda
                for(let i = 0; i<(820-anchura*2)/anchura; i++){
                    if(i != 6 && i != 7 && i != 5 && i != 8 && i != 4 && i != 3 && i != 9){
                        cuerpoRectangulo(10, 24 + (i*anchura),2,true);
                    }
                }
                //boca de la pared izquierda arriba
                for(let i = 0; i<(300-anchura*2)/anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(anchura + (i*anchura)-79,298,1,true);
                    }
                }
                for(let i = 0; i<(240-anchura*2)/anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(anchura + (i*anchura)-22,200,1,true);
                    }
                }
                //boca de la pared izquierda abajo
                for(let i = 0; i<(300-anchura*2)/anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(anchura + (i*anchura)-79,490,1,true);
                    }
                }
                for(let i = 0; i<(280-anchura*2)/anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(anchura + (i*anchura)-22,585,1,true);
                    }
                }
                //tapa de la boca izquierda
                for(let i = 3; i<(820-anchura*2)/anchura; i++){
                    if(i != 6 && i != 7 && i != 5 && i != 11 && i != 12 && i != 10 && i != 11){
                        cuerpoRectangulo(216, 24 + (i*anchura),2,true);
                    }
                }       
                //Pared vertical derecha
                for(let i = 0; i<(820-anchura*2)/anchura; i++){
                    if(i != 6 && i != 7 && i != 8  && i != 9  && i != 5  && i != 4  && i != 3){
                        cuerpoRectangulo(1175, 24 + (i*anchura),2,true);
                    }
                }    
                //boca de la pared derecha arriba
                let moverBocaDerecha = 330;
                for(let i = 0; i < (300 - anchura * 2) / anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(790 + moverBocaDerecha - 30 - (i * anchura) + 79, 298, 1, true);
                    }
                }
                for(let i = 0; i < (240 - anchura * 2) / anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(758+ moverBocaDerecha - (i * anchura) + 22, 200, 1, true);
                    }
                }
                //boca de la pared derecha abajo
                for(let i = 0; i < (300 - anchura * 2) / anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(790+ moverBocaDerecha - 30 - (i * anchura) + 79, 490, 1, true);
                    }
                }
                for(let i = 0; i < (280 - anchura * 2) / anchura; i++){
                    if(i != 11 && i != 10){
                        cuerpoRectangulo(758+ moverBocaDerecha- (i * anchura) + 22, 585, 1, true);
                    }
                }
                //tapa de la boca derecha
                for(let i = 3; i < (820 - anchura * 2) / anchura; i++){
                    if(i != 6 && i != 7 && i != 5 && i != 11 && i != 12 && i != 10 && i != 11){
                        cuerpoRectangulo(975, 24 + (i * anchura), 2, true);
                    }
                }
                //Mini pared de abajo a la izquierda
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + (i*anchura)-22,715,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                        cuerpoRectangulo(75, 665 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                        cuerpoRectangulo(216, 665 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + (i*anchura)-22,660,1,true);
                }
                //Mini pared de abajo a la derecha
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + moverse + (i*anchura)-22,715,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                        cuerpoRectangulo(75 + moverse, 665 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                        cuerpoRectangulo(216 + moverse, 665 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + moverse + (i*anchura)-22,660,1,true);
                }
                
                //Mini pared de arriba a la izquierda
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + (i*anchura)-22,135   ,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(75, 84 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(216, 84 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + (i*anchura)-22,75   ,1,true);
                }

                //Mini pared arriba a la derecha
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + moverse + (i*anchura)-22,135   ,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(75+ moverse, 84 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(216+ moverse, 84 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(240-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura+ moverse + (i*anchura)-22,75   ,1,true);
                }

                //Mini pared arriba a la derecha
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 250 + (i*anchura)-22,135   ,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(75 + 250, 84 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(216 + 308, 84 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 250 + (i*anchura)-22,75   ,1,true);
                }

                //Mini pared arriba a la derecha
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 250 + (i*anchura)-22, 715   ,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(75 + 250, 665 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(216 + 308, 665 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 250 + (i*anchura)-22,660   ,1,true);
                }
                //Mini pared arriba a la derecha
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 590 + (i*anchura)-22, 715   ,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(75 + 590, 665 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(216 + 648, 665 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 590 + (i*anchura)-22,660   ,1,true);
                }

                //Mini pared arriba a la derecha
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 590 + (i*anchura)-22, 135   ,1,true);
                }
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(75 + 590, 84 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(120-anchura*2)/anchura; i++){
                    cuerpoRectangulo(216 + 648, 84 + (i*anchura),2,true);
                }   
                for(let i = 1; i<(320-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 590 + (i*anchura)-22,75,1,true);
                }
                for(let i = 0; i<(300-anchura*2)/anchura; i++){
                    cuerpoRectangulo(595, 30 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(300-anchura*2)/anchura; i++){
                    cuerpoRectangulo(595, 537 + (i*anchura),2,true);
                }

                //division tipo T izquierda
                for(let i = 0; i<(500-anchura*2)/anchura; i++){
                    cuerpoRectangulo(300, 200 + (i*anchura),2,true);
                }   
                for(let i = 0; i<(500-anchura*2)/anchura; i++){
                    if(i != 3 && i != 2 && i != 4)
                        cuerpoRectangulo(440, 200 + (i*anchura),2,true);
                }
                for(let i = 1; i<(280-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 340 + (i*anchura)-22,320,1,true);
                }   
                for(let i = 1; i<(280-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 340 + (i*anchura)-22,472,1,true);
                }   
                for(let i = 1; i<(280-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 225 + (i*anchura)-22,200,1,true);
                }
                for(let i = 1; i<(280-anchura*2)/anchura; i++){
                    cuerpoRectangulo(anchura + 225 + (i*anchura)-22,593,1,true);
                }
                for(let i = 2; i<(400-anchura*2)/anchura; i++){
                    cuerpoRectangulo(555, 200 + (i*anchura),2,true);
                }   

                //division tipo T derecha
                let moverT = 580;
                for(let i = 0; i < (500 - anchura * 2) / anchura; i++){
                    cuerpoRectangulo(310 + moverT, 200 + (i * anchura), 2, true);
                }
                for(let i = 0; i < (500 - anchura * 2) / anchura; i++){
                    if(i != 3 && i != 2 && i != 4)
                        cuerpoRectangulo(170 + moverT, 200 + (i * anchura), 2, true);
                }
                for(let i = 1; i < (280 - anchura * 2) / anchura; i++){
                    cuerpoRectangulo(anchura + moverT + 110 - (i * anchura) + 22, 320, 1, true);
                }
                for(let i = 1; i < (280 - anchura * 2) / anchura; i++){
                    cuerpoRectangulo(anchura + moverT + 110 - (i * anchura) + 22, 472, 1, true);
                }
                for(let i = 1; i < (280 - anchura * 2) / anchura; i++){
                    cuerpoRectangulo(anchura + moverT + 225 - (i * anchura) + 22, 200, 1, true);
                }
                for(let i = 1; i < (280 - anchura * 2) / anchura; i++){
                    cuerpoRectangulo(anchura + moverT + 225 - (i * anchura) + 22, 593, 1, true);
                }
                for(let i = 2; i < (400 - anchura * 2) / anchura; i++){
                    cuerpoRectangulo(60 + moverT, 200 + (i * anchura), 2, true);
                }

                
                createFlag = true;
            }
            function cambioDeLugarMapa(_player){
                if(_player.getY + _player.getHeight < 0)
                    _player.y = 780;
                if(_player.getY > 780)
                    _player.y = 5;
                if(_player.getX + _player.getWidth < 0)
                    _player.x = 1170;
                if(_player.getX > 1170)
                    _player.x = 0;
            }
            function detectorColisiones(_player){
                for (let index = 0; index < walls.length; index++) {
                    if(_player.getX + 10 < walls[index].getX + walls[index].getWidth && _player.getX + _player.getWidth*2 -10 > walls[index].getX
                    && _player.getY + 10 < walls[index].getY + walls[index].getHeight && _player.getY + _player.getHeight*2 -10> walls[index].getY){
                        collisionIndex = index;
                        if (direction === 90) { // Arriba
                            player.y +=10;
                        } else if (direction === 270) { // Abajo
                            player.y -=10;
                        } else if(direction == 180){ // Izquierda 
                            player.x +=10;
                        }else { // Derecha
                            player.x -=10;
                        }
                        moveX = 0;
                        moveY = 0;
                    }   
                }
                for(let findex = 0; findex < walls.length; findex++){
					for(let sindex = 0; sindex < enemies.length; sindex++){
						if(enemies[sindex].getX < walls[findex].getX + walls[findex].getWidth &&  enemies[sindex].getX + enemies[sindex].getWidth > walls[findex].getX && 
						enemies[sindex].getY < walls[findex].getY + walls[findex].getHeight &&  enemies[sindex].getY + enemies[sindex].getWidth > walls[findex].getY){	
							tocarBorde(enemies[sindex]);
						}		
						//CAMBIO ALEATORIO DE DIRECCIÃN CON BORDE
						if(enemies[sindex].getX <= 0){
							tocarBorde(enemies[sindex]);
						}else if(enemies[sindex].getX >= 1470 - enemies[sindex].getWidth){
							tocarBorde(enemies[sindex]);
						}else if(enemies[sindex].getY <= 0){
							tocarBorde(enemies[sindex]);
						}else if(enemies[sindex].getY >= 800 - enemies[sindex].getWidth){
							tocarBorde(enemies[sindex]);
						}

					}   
				}
            }
            
            //Destruir Muro en colision
            function destruirMuro(_index){
                walls[_index].x = 9999;
            }

            function movimientoEnemigos(){
                for(let findex = 0; findex < enemies.length; findex++){
                    
                    if(enemies[findex].movementx == 1){
                        enemies[findex].x +=enemyspeed;
                    }else if(enemies[findex].movementx == 0){
                        enemies[findex].x -=enemyspeed;
                    }else if(enemies[findex].movementy == 0){
                        enemies[findex].y -=enemyspeed;
                    }else if(enemies[findex].movementy == 1){
                        enemies[findex].y +=enemyspeed;
                    }
                    ctx.drawImage(enemies[findex].img, enemies[findex].getX, enemies[findex].getY, enemies[findex].getWidth, enemies[findex].getWidth);
                }
            }
            function cambio(){
                if(Math.round(Math.random()) == 1){
                    flag2 = true;
                }else
                    flag2 = false;
                return flag2;
            }

            let cambiores;
            function tocarBorde(changolion){
                if(changolion.movementx == 0){
                    changolion.x += 5;
                    if(cambio()){
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementx == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementx == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementy = 3;
                        changolion.movementx = cambiores ? 1 : 0;
                    }else{
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementy == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementy == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementx = 3;
                        changolion.movementy = cambiores ? 1 : 0;
                    }
                }else if(changolion.movementx == 1){
                    changolion.x -= 5;
                    if(cambio()){
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementx == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementx == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementy = 3;
                        changolion.movementx = cambiores ? 1 : 0;
                    }else{
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementy == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementy == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementx = 3;
                        changolion.movementy = cambiores ? 1 : 0;
                    }
                }else if(changolion.movementy == 1){
                    changolion.y -= 5;
                    if(cambio()){
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementx == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementx == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementy = 3;
                        changolion.movementx = cambiores ? 1 : 0;
                    }else{
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementy == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementy == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementx = 3;
                        changolion.movementy = cambiores ? 1 : 0;
                    }
                }else if(changolion.movementy == 0){
                    changolion.y += 5;
                    if(cambio()){
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementy == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementy == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementy = 3;
                        changolion.movementx = cambiores ? 1 : 0;
                    }else{
                        cambiores = cambio();
                        while(true){
                            if(cambiores && changolion.movementy == 1)
                                cambiores = cambio();
                            else if(!cambiores && changolion.movementy == 0)
                                cambiores = cambio();
                            else
                                break;
                        }
                        changolion.movementx = 3;
                        changolion.movementy = cambiores ? 1 : 0;
                    }
                }
            }
            function enemigos(){
                movimientoEnemigos();

            }

            let contadorr = 0;
            var ultimoCuadro = 0, fps = 60; 
            function Animacion() {
                var ahora = Date.now();
                var tiempoTranscurrido = ahora - ultimoCuadro;
                var intervaloCuadro = 1000 / fps; 

                if (tiempoTranscurrido > intervaloCuadro) {
                    ultimoCuadro = ahora - (tiempoTranscurrido % intervaloCuadro);
                    cambioDeLugarMapa(player);
                    fondoNegro();
                    enemigos();
                    dibujarEscenario();
                    animacionPacman();
                    detectorColisiones(player);
                    contadorr++;
                    if(contadorr>320){
                        for(let findex = 0; findex < enemies.length/2; findex++){
                            tocarBorde(enemies[Math.floor(Math.random() * (enemies.length - 0 + 0) + 0)]);
                        }
                        tiempo++;
                        contadorr = 0;
                        console.log("TIEMPO: "+tiempo);
                    }
                }
                window.requestAnimationFrame(Animacion);
            }
            Animacion();
        </script>
    </body>
</html>